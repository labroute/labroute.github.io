<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artículos Técnicos - LabRoute</title>

  <!-- Tailwind (mismo stack visual que venías usando) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Estilos mínimos para badges y tarjetas (coinciden con tu look & feel) -->
  <style>
    body { background: radial-gradient(1200px 800px at 50% -200px, rgba(56,189,248,.08), transparent 60%) #0b1220; color: #e5e7eb; }
    .container { max-width: 1200px; }
    .section-title { font-weight: 800; letter-spacing: .3px; }
    .subtitle { color: #93a3b8; }

    .article-card { background: rgba(15,23,42,.6); border: 1px solid rgba(100,116,139,.25); border-radius: 1rem; }
    .article-card:hover { border-color: rgba(148,163,184,.55); box-shadow: 0 10px 25px rgba(0,0,0,.25); }
    .category-badge{
      display:inline-block; font-size:.70rem; font-weight:700; letter-spacing:.4px;
      padding:.25rem .55rem; border-radius:.5rem; background:#1f2937; color:#60a5fa; border:1px solid rgba(100,116,139,.35);
    }
    .difficulty-badge{
      display:inline-block; font-size:.70rem; font-weight:700; letter-spacing:.4px;
      padding:.25rem .55rem; border-radius:.5rem; margin-left:.4rem; border:1px solid rgba(100,116,139,.35);
      background:#1f2937; color:#f59e0b;
    }
    .difficulty-beginner { color:#34d399; }
    .difficulty-intermediate { color:#f59e0b; }
    .difficulty-advanced { color:#f87171; }
    .pill { border: 1px solid rgba(148,163,184,.25); background: rgba(15,23,42,.55); }
    .hidden { display:none; }
  </style>
</head>

<body class="min-h-screen">
  <!-- Header -->
  <header class="py-10">
    <div class="container mx-auto px-6">
      <h1 class="text-4xl md:text-5xl section-title text-sky-300">&lt;LabRoute&gt;</h1>
    </div>
  </header>

  <main class="container mx-auto px-6 pb-24">
    <!-- Título + descripción -->
    <section class="mb-10">
      <h2 class="text-center text-3xl md:text-4xl font-extrabold mb-3">Todos los Artículos</h2>
      <p class="subtitle text-center max-w-3xl mx-auto">
        Conocimiento técnico organizado por categorías y dificultad
      </p>
    </section>

    <!-- Controles (Búsqueda + Filtros) -->
    <section class="mb-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="flex gap-2 flex-wrap">
        <button class="filter-button pill text-sm px-4 py-2 rounded-xl" data-filter="Todos">Todos</button>
        <button class="filter-button pill text-sm px-4 py-2 rounded-xl" data-filter="Network Security">Network Security</button>
        <button class="filter-button pill text-sm px-4 py-2 rounded-xl" data-filter="Automation">Automation</button>
        <button class="filter-button pill text-sm px-4 py-2 rounded-xl" data-filter="OSINT">OSINT</button>
        <button class="filter-button pill text-sm px-4 py-2 rounded-xl" data-filter="Threat Hunting">Threat Hunting</button>
        <button class="filter-button pill text-sm px-4 py-2 rounded-xl" data-filter="Malware Analysis">Malware Analysis</button>
        <button class="filter-button pill text-sm px-4 py-2 rounded-xl" data-filter="Penetration Testing">Penetration Testing</button>
      </div>
      <div class="relative max-w-sm">
        <input class="search-bar w-full pill px-4 py-2 rounded-xl placeholder-slate-400 text-slate-200"
               type="search" placeholder="Buscar artículos…" />
        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500">⌘K</span>
      </div>
    </section>

    <!-- LISTADO -->
    <section id="articles-list-section" class="bg-slate-800/30 rounded-2xl p-6">
      <div id="articles-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Se rellena dinámicamente -->
      </div>
    </section>

    <!-- DETALLE -->
    <section id="article-detail" class="hidden mt-12">
      <a id="back-to-articles" href="#" class="inline-flex items-center text-sky-400 hover:text-sky-300 mb-6">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg> Volver a artículos
      </a>

      <article class="article-card p-8">
        <div class="flex flex-wrap items-center gap-2 article-meta mb-4">
          <!-- badges dinámicas -->
        </div>
        <h1 class="text-3xl md:text-4xl font-extrabold mb-4">Título</h1>
        <div class="article-content prose prose-invert max-w-none">
          <!-- contenido renderizado desde Markdown -->
        </div>
      </article>
    </section>
  </main>

  <!-- Librerías para parsear Front Matter y Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/gray-matter@3.1.1/dist/gray-matter.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Lógica: listar, filtrar y mostrar detalle desde GitHub -->
  <script>
    // === Config (ajusta si cambiás algo) ===
    const GH_USER   = "labroute";
    const GH_REPO   = "labroute.github.io";
    const GH_BRANCH = "main";
    const CONTENT_PATH = "articulos/contenido"; // donde Decap guarda los .md

    // Elementos UI
    const gridEl        = document.getElementById("articles-grid");
    const listSection   = document.getElementById("articles-list-section");
    const detailSection = document.getElementById("article-detail");
    const backBtn       = document.getElementById("back-to-articles");
    const searchEl      = document.querySelector(".search-bar");
    const filterBtns    = document.querySelectorAll(".filter-button");

    let ARTICLES = [];
    let CURRENT  = null;

    // Helpers de UI
    const diffClass = (d) => d === "Avanzado" ? "difficulty-advanced" : (d === "Intermedio" ? "difficulty-intermediate" : "difficulty-beginner");

    function cardTemplate(a) {
      return `
        <div class="article-card rounded-2xl p-6">
          <div class="mb-3">
            <span class="category-badge">${a.category || "General"}</span>
            <span class="difficulty-badge ${diffClass(a.difficulty || "Intermedio")}">
              ${a.difficulty || "Intermedio"}
            </span>
          </div>
          <h3 class="text-xl font-bold mb-3">${a.title}</h3>
          <p class="text-slate-400 mb-4 text-sm leading-relaxed">${a.excerpt || ""}</p>
          <div class="flex items-center justify-between text-xs text-slate-500 mb-4">
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              ${a.reading_time ? `${a.reading_time} min lectura` : "—"}
            </div>
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
              ${a.views || "—"} vistas
            </div>
          </div>
          <div class="text-xs text-slate-500 mb-4">
            Publicado: ${a.date ? new Date(a.date).toLocaleDateString("es-ES", {day:"2-digit", month:"long", year:"numeric"}) : "—"}
          </div>
          <button class="block w-full text-center bg-slate-700 text-white py-2 rounded-lg hover:bg-slate-600 transition-colors"
                  data-slug="${a.slug}">
            Leer Artículo
          </button>
        </div>
      `;
    }

    function renderCards(list) {
      if (!list.length) {
        gridEl.innerHTML = `<div class="text-slate-400">No hay artículos publicados aún.</div>`;
        return;
      }
      gridEl.innerHTML = list.map(cardTemplate).join("");
      gridEl.querySelectorAll("button[data-slug]").forEach(btn => {
        btn.addEventListener("click", () => openDetail(btn.dataset.slug));
      });
    }

    async function openDetail(slug) {
      const art = ARTICLES.find(x => x.slug === slug);
      if (!art) return;
      CURRENT = art;

      // Cabecera del detalle
      const metaWrap = detailSection.querySelector(".article-meta");
      metaWrap.innerHTML = `
        <span class="category-badge">${art.category || "General"}</span>
        <span class="difficulty-badge ${diffClass(art.difficulty || "Intermedio")}">
          ${art.difficulty || "Intermedio"}
        </span>
        <span class="ml-2 text-sm text-slate-400">
          ${art.reading_time ? `${art.reading_time} min lectura` : ""}
        </span>
      `;
      detailSection.querySelector("h1").textContent = art.title;

      // Cuerpo del detalle (Markdown -> HTML con marked)
      const contentEl = detailSection.querySelector(".article-content");
      const cover = art.cover ? `<img src="${art.cover}" alt="${art.title}" class="w-full h-64 object-cover rounded-xl mb-8">` : "";
      contentEl.innerHTML = cover + marked.parse(art.body || "");

      // Mostrar detalle / ocultar listado
      listSection.classList.add("hidden");
      detailSection.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    backBtn.addEventListener("click", (e) => {
      e.preventDefault();
      detailSection.classList.add("hidden");
      listSection.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    // Filtros y búsqueda
    filterBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        filterBtns.forEach(b => b.classList.remove("ring-2", "ring-sky-500"));
        btn.classList.add("ring-2", "ring-sky-500");
        const cat = btn.dataset.filter;
        const list = (cat === "Todos")
          ? ARTICLES
          : ARTICLES.filter(a => (a.category || "").toLowerCase() === cat.toLowerCase());
        renderCards(list);
      });
    });

    if (searchEl) {
      searchEl.addEventListener("input", (e) => {
        const q = e.target.value.toLowerCase();
        const list = ARTICLES.filter(a =>
          (a.title || "").toLowerCase().includes(q) ||
          (a.excerpt || "").toLowerCase().includes(q)
        );
        renderCards(list);
      });
    }

    // === Carga desde GitHub (API pública) ===
    async function fetchJSON(url) {
      const r = await fetch(url);
      if (!r.ok) throw new Error("HTTP " + r.status);
      return r.json();
    }
    async function fetchText(url) {
      const r = await fetch(url);
      if (!r.ok) throw new Error("HTTP " + r.status);
      return r.text();
    }

    async function loadArticles() {
      // 1) Lista de archivos
      const listURL = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/${CONTENT_PATH}?ref=${GH_BRANCH}`;
      const files = await fetchJSON(listURL);
      const mdFiles = files.filter(f => f.name.endsWith(".md"));

      // 2) Parsear cada MD
      const items = [];
      for (const f of mdFiles) {
        const rawURL = `https://raw.githubusercontent.com/${GH_USER}/${GH_REPO}/${GH_BRANCH}/${CONTENT_PATH}/${encodeURIComponent(f.name)}`;
        const text = await fetchText(rawURL);
        const parsed = window.matter(text); // gray-matter

        const data = parsed.data || {};
        items.push({
          slug: f.name.replace(/\.md$/i,""),
          title: data.title || f.name,
          date: data.date || null,
          category: data.category || null,
          difficulty: data.difficulty || null,
          reading_time: data.reading_time || null,
          cover: data.cover || null,
          excerpt: data.excerpt || (parsed.content.trim().split("\n").slice(0,3).join(" ").substring(0,180) + "…"),
          views: data.views || null,
          body: parsed.content
        });
      }

      // 3) Ordenar por fecha (desc)
      items.sort((a,b) => new Date(b.date || 0) - new Date(a.date || 0));

      ARTICLES = items;
      renderCards(ARTICLES);
    }

    // Arranque
    loadArticles().catch(err => {
      console.error("Error cargando artículos:", err);
      gridEl.innerHTML = `<div class="text-slate-400">No se pudieron cargar los artículos.</div>`;
    });
  </script>
</body>
</html>
